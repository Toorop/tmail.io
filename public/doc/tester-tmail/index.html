<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Tester tmail &middot; tmail </title>

  
  <link rel="stylesheet" href="http://localhost:1313/css/poole.css">
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:1313/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="tmail" />
</head>

<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>tmail</h1>
      <p class="lead">
       devblog 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
        <li><a href="http://localhost:1313/faq/"> FAQ </a></li>
      
      <li><a href="mailto:toorop@toorop.fr"> Contact </a></li>
    </ul>

    
  </div>
</div>

    <div class="content container">
<div class="post">
  <h1>Tester tmail</h1>
  <span class="post-date">Thu, Jan 29, 2015</span>
      

<p>Durant tout le cycle de développement je vais mettre à disposition le nécessaire pour qu&rsquo;il soit possible de tester les fonctionnalités qui sont implémentées.</p>

<p>Qu&rsquo;il n&rsquo;y ait pas de malentendu, on ne parle pas ici de version bêta, ni même alpha, ce sera à chaque fois une version de dev, avec plein de choses non implémentées et forcement de nombreux bugs.</p>

<p><strong>En clair: n&rsquo;utiliser pas ces versions en prod</strong></p>

<p>Pour le moment tmail est très basique, mais il devrait cependant vous permettre d&rsquo;envoyer et de relayer des mails.</p>

<p>On va partir sur une installation qui va nous permettre de mettre en place un service SMTP basique qui va:</p>

<ul>
<li>écouter sur les ports 25 et 587 (avec STARTTLS).</li>
<li>écouter sur le port 465 en SSL.</li>
<li>accepter tous les mails à destination du domaine <em>toorop.fr</em> et qui va les router vers <em>mail.toorop.fr</em></li>
<li>permettre à l&rsquo;utilisateur <em>toorop@toorop.fr</em> ayant comme mot de passe <em>passwd</em> d&rsquo;utiliser le service pour envoyer des mails (quelque soit la destination).</li>
<li>router tous les mails à destination de <em>gmail.com</em> vers mailjet.</li>
</ul>

<h2 id="prérequis:d019151a35bd08da572f2cd4d05e6707">Prérequis</h2>

<p>Pour le moment je ne fournis que le binaire Linux 32bits, vous n&rsquo;avez donc besoin de rien d&rsquo;autre pour tester qu&rsquo;une machine sous Linux. Pour cet exemple je vais utiliser un <a href="https://www.ovh.com/fr/vps/vps-classic.xml">VPS Classic 1 OVH</a> sous <em>Ubuntu server 64bits</em>.</p>

<p>Pensez à vous assurer que vous pouvez utiliser les ports SMTP (ou alors testez sur des ports alternatifs).</p>

<p>A noter que comme backend pour la base de données vous pouvez utiliser sqlite, MySQl (et dérivés) ou Postgresql. Pour cette première phase je vous encourage chaudement à utiliser sqlite ce sera amplement suffisant.</p>

<p>A terme, tmail sera splitté en composants sous forme de container Docker, dans ce qui suit je vais jsute expliquer l&rsquo;installation &ldquo;standalone&rdquo; (vs cluster).</p>

<h3 id="note-sur-l-utilisation-des-ports-inférieurs-à-1024:d019151a35bd08da572f2cd4d05e6707">Note sur l&rsquo;utilisation des ports inférieurs à 1024</h3>

<p>Sur un système linux un processus ne peut ouvrir un port inférieur à 1024 que si il est root.
Une des limitations de Go fait que l&rsquo;on ne peut pas lancer d&rsquo;application sous l&rsquo;utilisateur root pour ouvrir les ports nécessaires et ensuite forker sous un autre user.<br />
Il y à plusieurs autres solutions pour contourner ce problème, la plus simple à mettre en œuvre est d&rsquo;utiliser iptables :</p>

<pre><code>iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 25 -j REDIRECT --to-port 2525
</code></pre>

<h2 id="installation:d019151a35bd08da572f2cd4d05e6707">Installation</h2>

<h2 id="configuration:d019151a35bd08da572f2cd4d05e6707">Configuration</h2>

<h3 id="base:d019151a35bd08da572f2cd4d05e6707">Base</h3>

<h3 id="prise-en-charge-des-mails-du-domaine-toorop-fr:d019151a35bd08da572f2cd4d05e6707">Prise en charge des mails du domaine toorop.fr</h3>

<h3 id="router-les-mails-à-destination-du-domaine-toorop-fr-vers-mail-toorop-fr:d019151a35bd08da572f2cd4d05e6707">Router les mails à destination du domaine toorop.fr vers mail.toorop.fr</h3>

<h3 id="ajout-de-utilisateur-toorop-toorop-fr:d019151a35bd08da572f2cd4d05e6707">Ajout de utilisateur toorop@toorop.fr</h3>

<h3 id="router-les-mails-à-destination-de-gmail-com-vers-mailjet:d019151a35bd08da572f2cd4d05e6707">Router les mails à destination de gmail.com vers Mailjet.</h3>

<p>Si vous avez des questions, des remarques, des bugs à remonter</p>

</div>
</div>
  <script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
